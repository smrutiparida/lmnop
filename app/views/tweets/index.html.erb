<script>
$( document ).ready(function() {
  $.getJSON( "http://54.254.80.93/tweet-store/index.php/api/TweetsUnique/prio_user/low=700&high=800&size=50&top=0", 
      function( data ) {
        if (data["success"]) {
          addtoList(data);
        }
  });
/*   $('#viewselect').change(function() {
    if($("#viewselect option:selected").text() == "Tweets"){
      $("#tweetTime").fadeIn("slow").show();
    }else{
      $("#tweetTime").hide();
    }
  });
*/
});
function timeSince(date) {
  var curTime = new Date();
  var timezoneDiff = curTime.getTimezoneOffset() * 60000;
  var seconds = Math.floor((curTime.getTime() - (new Date(date)).getTime() + timezoneDiff) / 1000);
  var interval = Math.floor(seconds / 31536000);
  if (interval > 0) {
  return interval + "y ago";
  }
  interval = Math.floor(seconds / 2592000);
  if (interval > 0) {
  return interval + "mth ago";
  }
  interval = Math.floor(seconds / 86400);
  if (interval > 0) {
  return interval + "d ago";
  }
  interval = Math.floor(seconds / 3600);
  if (interval > 0) {
  return interval + "h ago";
  }
  interval = Math.floor(seconds / 60);
  if (interval > 0) {
  return interval + "m ago";
  }
  return Math.floor(seconds) + "s ago";
}

function changeColor(){
  document.getElementById('prgressHighlight').style.width = rangeinput.value+"%";
  var score = (100 - rangeinput.value) * 8;
  document.getElementById('rangevalue').value = score;
  $.getJSON( "http://54.254.80.93/tweet-store/index.php/api/TweetsUnique/prio_user/low=" + score + "&high=800&size=50&top=0",function( data ) {
        if (data["success"]) {
          addtoList(data);
        }
        else {
          $( "#tweetlist" ).text("No tweet to show");
        }
  });
}

function addtoList(data){
    $("#tweetlist").empty();
    $("#trending").empty();
    $.tmpl( "twitterTemplate", data["data"]["tweets"] ).appendTo( "#tweetlist" );
    $.tmpl("trendingTemplate", data["data"]["facets"]["hashtag_frequency"]["terms"]).appendTo( "#trending" );
    $(".timeCal").each(function(index){ $(this).text(timeSince($(this).text())); });
  }


  var markup = '<div class="twitSec"><div class="tw_img"><img src="${profile_image_url}" /></div><h1><a href="http://www.twitter.com/${screen_name}" target="_blank">${name}</a><span id="">@${screen_name}</span>&nbsp;<span class="timeCal">${created_at}</span></h1><p>${tweet_text}</p></div>';
  

  var hashtag = "<span class='label label-info' style='margin-right:5px;'><a href='#'' class='hashtagclick' onclick='update(\"${term}\");'>${term}</a></span>";
  
  $.template( "twitterTemplate", markup );
  $.template( "trendingTemplate", hashtag );
   
  //$(document).on("",'a.hashtagclick',  function(){});
  function update(val){  

    //var val_array =$( "#slider" ).slider( "values" );
    $("#tweetlist").empty();
    var score = (100 - rangeinput.value) * 8;
    $.getJSON( "http://54.254.80.93/tweet-store/index.php/api/TweetsUnique/prio_search/low=" + score + "&high=800&size=50&top=0&q=" + encodeURIComponent(val) ,function( data ) {
      if (data["success"]) {
        $.tmpl( "twitterTemplate", data["data"]["tweets"] ).appendTo( "#tweetlist" );
        $(".timeCal").each(function(index){ $(this).text(timeSince($(this).text())); });
      }
      else {
        $( "#tweetlist" ).text("No tweet to show");
      }
    });
  }
  //});
  
  
  

</script>
  <div class="mainDiv">
    <div id="slider">
      <div class="heading">
        <h1>Twitter Credibility Line</h1>
        <h2>Drag the slider to start. <a id="modal-more" href="#modal-container-more" data-toggle="modal" style="border:0; outline:none">How it works?</a></h2>
      </div>
      <div class="nav_selcet">
        <span style="padding-right:15px;">
          <b>Country</b>
          <span class="input-xlarge uneditable-input" style="width:200px; text-align:left">India</span>
        </span>
        <span style="padding-right:15px;">
          <b>View</b>
          <select id="viewselect">
            <!-- <option>Accounts</option> -->
            <option id="show">Tweets</option>
          </select>
        </span>
        <span style="display:none" id="tweetTime">
          <b>Topic</b>
          <select>
            <option>All</option>
            <option>News</option>
          </select>
        </span>
      </div>
      <div class="progressMain">
        <p class="rotateleft">verified a/c</p>
        <p class="rotateright">general a/c</p>
        <div class="progressbar">
          <div class="progressbar_2" style="width:1%;" id="prgressHighlight"></div>
        </div>
        <input class="bar" type="range" id="rangeinput" value="0" step="5" onchange="changeColor();" style="border:0; outline:none;"/>
        <span class="highlight"></span>
        <output id="rangevalue">800</output>
      </div>
    </div>
    <div class="tweetMainDiv">
      <div id="trending" class="tweetTags"></div>
      <div id="tweetlist"></div>  
    </div>
    <div id="modal-container-more" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3 id="myModalLabel">
          How it works?
        </h3>
      </div>
      <div class="modal-body">
        <p>
          We start with a set of verified accounts & then recursively find their followers with a belief that if a verified account A is following a non-verified account B, then B is credible too & pass on a % of A's credibility to B. If another verified account C follows B, then B's credibility gets further boost.
        </p>
        <p>This way, we figure out accounts which are credible but yet to be verified.</p>
        
      </div>
      <div class="modal-footer">
         <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
      </div>
    </div>
  </div>




